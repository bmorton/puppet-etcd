# etcd - distributed configuration daemon
#
# Maintained by Puppet. Do not edit by hand. 
#
description	"distributed configuration daemon"

start on runlevel [2345]
stop on runlevel [!2345]

respawn

env ETCD_ADVERTISE_CLIENT_URLS="<%= @addr -%>"
env ETCD_LISTEN_CLIENT_URLS="<%= @bind_addr -%>"
env ETCD_CA_FILE="<%= @ca_file -%>"
env ETCD_CERT_FILE="<%= @cert_file -%>"
<% if @cors and !@cors.empty? -%>
env ETCD_CORS=["<%=  @cors.join('", "') -%>"]
<% end -%>
env ETCD_CPU_PROFILE_FILE="<%= @cpu_profile_file -%>"
env ETCD_DATA_DIR="<%= @data_dir -%>"
env ETCD_KEY_FILE="<%= @key_file -%>"
<% if @peers and !@peers.empty? -%>
env ETCD_PEERS=["<%=  @peers.join('", "') -%>"]
<% end -%>
<% if @peers_file -%>
env ETCD_PEERS_FILE="<%= @peers_file -%>"
<% end -%>
<% if @discovery -%>
env ETCD_DISCOVERY="<%= @discovery_endpoint -%><%= @discovery_token -%>"
<% end -%>
env ETCD_MAX_RESULT_BUFFER=<%= @max_result_buffer %>
env ETCD_MAX_RETRY_ATTEMPTS=<%= @max_retry_attempts %>
env ETCD_NAME="<%= @node_name -%>"
env ETCD_SNAPSHOT=<%= @snapshot %>
env ETCD_SNAPSHOP_COUNT=<%= @snapshot_count %>
env ETCD_VERBOSE=<%= @verbose %>
env ETCD_VERY_VERBOSE=<%= @very_verbose %>

env ETCD_INITIAL_ADVERTISE_PEER_URLS="<%= @peer_addr -%>"
env ETCD_LISTEN_PEER_URLS="<%= @peer_bind_addr -%>"
env ETCD_PEER_CA_FILE="<%= @peer_ca_file -%>"
env ETCD_PEER_CERT_FILE="<%= @peer_cert_File -%>"
env ETCD_PEER_KEY_FILE="<%= @peer_key_file -%>"
env ETCD_ELECTION_TIMEOUT=<%=  @peer_election_timeout %>
env ETCD_HEARTBEAT_INTERVAL=<%=  @peer_heartbeat_interval %>

# Official way to run as a different user:
# http://upstart.ubuntu.com/cookbook/#run-a-job-as-a-different-user

exec su -s /bin/sh -c 'exec "$0" "$@"' <%= @user -%> -- <%= @binary_location %> -config /etc/etcd/etcd.conf >> <%= @log_dir %>/etcd.out

